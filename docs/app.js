(()=>{const e=[{plan:"Arcade",planType:"Monthly",planTypeAbbrev:"mo",currency:"$",price:9},{plan:"Advanced",planType:"Monthly",planTypeAbbrev:"mo",currency:"$",price:12},{plan:"Pro",planType:"Monthly",planTypeAbbrev:"mo",currency:"$",price:15},{plan:"Arcade",planType:"Yearly",planTypeAbbrev:"yr",currency:"$",price:90},{plan:"Advanced",planType:"Yearly",planTypeAbbrev:"yr",currency:"$",price:120},{plan:"Pro",planType:"Yearly",planTypeAbbrev:"yr",currency:"$",price:150}],n=[{addOn:"Online service",planType:"Monthly",planTypeAbbrev:"mo",currency:"$",price:1},{addOn:"Larger storage",planType:"Monthly",planTypeAbbrev:"mo",currency:"$",price:2},{addOn:"Customizable profile",planType:"Monthly",planTypeAbbrev:"mo",currency:"$",price:2},{addOn:"Online service",planType:"Yearly",planTypeAbbrev:"yr",currency:"$",price:10},{addOn:"Larger storage",planType:"Yearly",planTypeAbbrev:"yr",currency:"$",price:20},{addOn:"Customizable profile",planType:"Yearly",planTypeAbbrev:"yr",currency:"$",price:20}],r={personalInfo:null,plan:null,addOns:[]},t={PERSONAL_INFO:"personalInfo",PLANS:"plans",ADD_ONS:"addOns",FINISHING_UP:"finishingUp",THANK_YOU:"thankYou"},a="subscription__step-number--selected",l="subscription__button--next",c="subscription__button--confirm",s="Arcade",o="Advanced",p="Pro",i="Monthly",d="Yearly",u="arcade-plan",y="advanced-plan",m="pro-plan",v={[s]:u,[o]:y,[p]:m},b="Online service",f="Larger storage",h="Customizable profile",T=Object.values(t),A={required:"This field is required",email:"Invalid email"},S="invalid-control",g="invalid-message";let L=0;const q={email:new RegExp("^[\\w-.]+@([\\w-]+\\.)+[\\w-]{2,4}$")},O=document.querySelector("#step"),$=document.querySelector("#stepContent"),_=document.querySelector(".subscription__step-navigator"),C=document.querySelector("#backStep"),E=Array.from($.children).map((e=>e.children)).map((e=>e[2])).filter((e=>e));for(const e of E)e.addEventListener("click",k);function k(e){const n=e.target.closest(".subscription__button");n&&(n.classList.contains("subscription__button--back")?x():(n.classList.contains("subscription__button--next")||n.classList.contains("subscription__button--confirm"))&&N())}_.addEventListener("click",k);const x=()=>{0!==L&&(L--,0===L&&U(C,!1),J(),K(document.querySelector("#nextStep"),c,l,"Next Step"),R(T[L]))},N=()=>{L!==T.length-1&&(B()||(L++,U(C,!0),R(T[L])))},I=()=>document.createElement("strong"),w=()=>document.createElement("span"),Y=()=>document.createElement("div"),M=e=>{const n=Array.from(e.children).filter((e=>e.classList.contains("active")));for(const e of n)e.classList.remove("active")},P=e=>{e.classList.remove("active")},z=e=>{e.classList.add("active")},F=()=>{if(L>3)return;(()=>{const e=Array.from(O.children).map((e=>e.children[0])).filter((e=>e.classList.contains(a)));for(const n of e)n.classList.remove(a)})();const e=`step${L+1}`;O.children[e].children[0].classList.add(a)},D=()=>{const e=Array.from($.children).filter((e=>"flex"===e.style.display||""===e.style.display));for(const n of e)n.style.display="none"},R=e=>{D(),$.children[e].style.display="flex",F()},U=(e,n)=>e.style.visibility=n?"visible":"hidden",H=document.querySelector("#basicInfoForm");for(const e of H.elements)e.addEventListener("keyup",(e=>{e.target.value?"email-address"!==e.target.id||q.email.test(e.target.value)?G(e.target):j(e.target,A.email):j(e.target,A.required)}));const j=(e,n)=>{const r=(e=>{const n=Y(),r=w();return r.innerText=e,r.classList.add(g),n.append(r),n})(n),t=e.parentElement,a=t.querySelector("div");a&&t.removeChild(a),t.append(r),t.style.position="relative",e.classList.add(S)},G=e=>{e.classList.remove(S);const n=e.parentElement,r=n.querySelector("div");r&&n.removeChild(r)},K=(e,n,r,t)=>{e.classList.remove(n),e.classList.add(r),e.children[0].textContent=t},B=()=>{let e=!1;switch(L){case 0:(e=>{for(const n of e)G(n)})(H.elements);const{required:n,email:t}=A,{name:a,emailAddress:s,phoneNumber:o}=H.elements;""===a.value&&j(a,n),""===s.value?j(s,n):q.email.test(s.value)||j(s,t),""===o.value&&j(o,n),e=!a.value||!s.value||!o.value,e||(r.personalInfo={name:a.value,emailAddress:s.value,phoneNumber:o.value},H.reset());break;case 1:e=!r.plan,e||(M(Q),se(),ae());break;case 2:K(document.querySelector("#nextStep"),l,c,"Confirm"),oe();break;case 3:_.style.display="none"}return e},J=()=>{switch(L){case 0:if(!r.personalInfo)return;const{name:e,emailAddress:n,phoneNumber:t}=r.personalInfo;H.elements.name.value=e,H.elements.emailAddress.value=n,H.elements.phoneNumber.value=t;break;case 1:if(!r.plan)return;const{plan:a}=r.plan,l=v[a],c=Q.children[l];z(c);break;case 2:ae(),se()}},Q=document.querySelector(".subscription__step-card-plans"),V=document.querySelector("#switch-plan");Q.addEventListener("click",(e=>{const n=e.target.closest(".subscription__step-card-plan");n&&(M(Q),z(n),X(n))})),V.addEventListener("change",(e=>{const n=document.querySelector("#arcade-plan-price"),t=document.querySelector("#advanced-plan-price"),a=document.querySelector("#pro-plan-price"),l=document.querySelectorAll(".free-plan-info");e.target.checked?(W(n,d,s),W(t,d,o),W(a,d,p),Array.from(l).forEach((e=>{e.classList.add("free-plan-info--shown")}))):(W(n,i,s),W(t,i,o),W(a,i,p),Array.from(l).forEach((e=>{e.classList.remove("free-plan-info--shown")}))),M(Q),r.plan=null,r.addOns=[]}));const W=(n,r,t)=>{const a=e.filter((e=>e.planType===r)),{currency:l,price:c,planTypeAbbrev:s}=a.find((e=>e.plan===t));n.textContent=`${l}${c}/${s}`},X=n=>{r.plan=null;const t=document.querySelector("#switch-plan").checked?d:i;switch(n.id){case u:r.plan=e.find((e=>e.plan===s&&e.planType===t));break;case y:r.plan=e.find((e=>e.plan===o&&e.planType===t));break;case m:r.plan=e.find((e=>e.plan===p&&e.planType===t))}},Z=document.querySelector("#online-service"),ee=document.querySelector("#larger-storage"),ne=document.querySelector("#customizable-profile");Z.addEventListener("change",(e=>{re(e),te(b,e)})),ee.addEventListener("change",(e=>{re(e),te(f,e)})),ne.addEventListener("change",(e=>{re(e),te(h,e)}));const re=e=>{e.target.checked?z(e.target.parentElement):P(e.target.parentElement)},te=(e,t)=>{if(t.target.checked){const t=r.plan.planType,a=n.find((n=>n.addOn===e&&n.planType===t));r.addOns.some((n=>n.addOn===e))||r.addOns.push(a)}else r.addOns=r.addOns.filter((n=>n.addOn!==e))},ae=()=>{if(!r.plan)return;const{planType:e}=r.plan,n=document.querySelector("#online-service-price"),t=document.querySelector("#larger-storage-price"),a=document.querySelector("#customizable-profile-price");le(n,b,e),le(t,f,e),le(a,h,e)},le=(e,r,t)=>{const{currency:a,price:l,planTypeAbbrev:c}=n.find((e=>e.addOn===r&&e.planType===t));e.textContent=`${a}${l}/${c}`},ce=(e,n)=>{let t=r.addOns.some((e=>e.addOn===n));t?(e.checked=t,z(e.parentElement)):(e.checked=!1,P(e.parentElement))},se=()=>{ce(Z,b),ce(ee,f),ce(ne,h)};document.querySelector("#change-selected-plan").addEventListener("click",(e=>{e.preventDefault(),L=1,J(),R(T[L])}));const oe=()=>{(()=>{const e=document.querySelector("#selected-plan"),n=document.querySelector("#summary-price"),{plan:t,planType:a,currency:l,price:c,planTypeAbbrev:s}=r.plan;let o=I();o.textContent=`${t} (${a})`,e.childElementCount>0&&e.children[0].remove(),e.append(o),o=I(),o.textContent=`${l}${c}/${s}`,n.childElementCount>0&&n.firstChild.remove(),n.append(o)})(),(()=>{const e=document.querySelector(".subscription__summary-add-ons-selected");for(;e.firstChild;)e.removeChild(e.firstChild);for(const n of r.addOns){const{addOn:r,currency:t,price:a,planTypeAbbrev:l}=n,c=Y(),s=w();s.textContent=r;const o=w();o.classList.add("price","price--summary"),o.textContent=`+${t}${a}/${l}`,c.append(s,o),e.append(c)}})(),(()=>{let e=0;e+=r.plan.price;const n=r.addOns.reduce(((e,n,r)=>e+n.price),0);e+=n;const{planType:t,currency:a,planTypeAbbrev:l}=r.plan,c=document.querySelector("#summary-total-name"),s=t===i?"month":"year";c.textContent=`Total (per ${s})`;const o=document.querySelector("#summary-total-price");o.firstChild&&o.removeChild(o.firstChild);const p=I();p.textContent=`${a}${e}/${l}`,o.append(p)})()};D(),$.children[t.PERSONAL_INFO].style.display="flex",L=0,F(),U(C,!1)})();